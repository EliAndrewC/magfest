{% extends "base.html" %}{% set admin_area=True %}
{% block title %}Example Automated Emails{% endblock %}
{% block content %}

{% macro preview(body, format) %}
  {% if format == 'html' %}
    <div class="well">{{ body|safe }}</div>
  {% else %}
    <pre class="well" style="white-space:pre-wrap">{{ body }}</pre>
  {% endif %}
{% endmacro %}

<h2>{{ email.subject }}</h2>

<div class="center">
  <a href="pending">Return to pending email list</a>
</div>
<br>

{% if email.unapproved_count > 0 %}
  There are {{ email.unapproved_count }} copies of this email that will be sent once it's approved.<br><br>
{% elif examples %}
  Congratulations! There are no unsent copies of this email waiting to be approved!<br><br>
{% endif %}

{% if examples %}
  The following are some examples of this email:
  {% for model, body in examples %}
    <h3>To: {{ model|form_link }}</h3>
    {{ preview(body, email.format) }}
  {% endfor %}
{% else %}
  No recepients match the email criteria.<br><br>
  Here's what the template looks like though:<br>
  {{ preview(email.body, email.format) }}
{% endif %}

{% endblock %}
