{% extends "base-admin.html" %}
{% block title %}Shifts{% endblock %}
{% block page_styles %}
<!--inside page_style -->
<link rel="stylesheet" href="../static/styles/fullcalendar.min.css" />
<link rel="stylesheet" href="../static/styles/fullcalendar.print.css" media="print"/>


{% endblock %}

{% block content %}

{% include "jobs/main_menu.html" %}

<div clas="row">
{% if checklist.relevant %}
    {% if checklist.completed %}
        You've already indicated that what's here and/or whatever shifts STOPS creates are fine.  Let us know if that's in error.
    {% else %}
        {% if location in c.SHIFTLESS_DEPTS %}
            This department is on record as not needing any shifts.  Please click the following link to confirm this so we know we don't need to make any shifts.  If this is in error and you'd like shifts for your people, please let us know and we'll fix that.
        {% else %}
            STOPS usually makes shifts for each department based on last year's shifts.  You can create shifts yourself or let us do it for you.  If you want to make shifts yourself, please do so and then click the link below.  If you want us to make shifts for you, just click that link now and submit the form to confirm that.
        {% endif %}
        <br/> <a href="#" onClick="$('#checkoff').show(); return false;">I Don't Need To Do Anything Else Here</a>
        <form id="checkoff" style="display:none" method="post" action="../dept_checklist/mark_item_complete">
        {% csrf_token %}
        <input type="hidden" name="slug" value="{{ checklist.conf.slug }}" />
        <input type="submit" value="I Confirm I Don't Need To Do Anything Else Here" />
        </form>
    {% endif %}
{% endif %}
</div>
<div class="row text-center">
	<div class="col-md-4">
	    <h3>Setup Shifts ({{ setup|list_length }})</h3>	
	</div>
        <div class="col-md-4">
            <h3>Teardown Shifts ({{teardown|list_length}})</h3>
        </div>
	<div class="col-md-4">
	    <h3>Regular Shifts ({{normal|list_length}})</h3>
	</div>

</div>
<div class="row text-center">

        <div class="col-md-4">
	    <a class="btn btn-primary" href="form?id=None&location={{ location }}&type={{c.SETUP}}">Add Setup Shift</a>

        </div>
        <div class="col-md-4">
            <a class="btn btn-primary" href="form?id=None&location={{ location }}&type={{c.TEARDOWN}}">Add Teardown Shift</a>

        </div>
        <div class="col-md-4">
            <a class="btn btn-primary" href="form?id=None&location={{ location }}">Add Shift</a>

        </div>

</div>
{% comment %}
<div class="row">
        <div class="col-md-12">
    {% for job in teardown %}
        <li>
            [<b>{{ job.start_time|datetime:"%I %p %a" }}</b> for an expected ~{{ job.duration }} hours]
            <a href="form?id={{ job.id }}">{{ job.name }}</a>:
            {{ job.shifts|length }}/{{ job.slots }} Staffers <a href="staffers_by_job?id={{ job.id }}">Signed Up</a>
        </li>
    {% endfor %}

        </div>
</div>
{% endcomment %}



<!-- Starting with calendar implementation -->
<div class="row">
	<div class="col-md-12">
		<div id="shift_cal"></div>
	</div>
</div>
<div class="row" style="margin-bottom:50px;"></div>


<!--
<table class="calendar" border="1">
{% for curr_dt, prev_dt, jobs in times %}
    <tr>
        <td>
            <nobr>{{ curr_dt|date:"gA"|lower }} {{ curr_dt|date:"D" }}</nobr>
            <br/> <br/>
            <nobr><a href="form?id=None&location={{ location }}&start_time={{ curr_dt|date:"Y-m-d H:i:s" }}">Add Shift</a></nobr>
            <a name="{{ prev_dt|stringformat:"s" }}"></a>
        </td>
        {% for job in jobs %}
            <td rowspan="{{ job.duration }}">
                <nobr> <a href="form?id={{ job.id }}"><b>{{ job.name }}{% if job.restricted %}*{% endif %}</b></a> </nobr>
                <br/> <br/>
                <nobr> Weight: x{{ job.weight }}{% if job.extra15 %}*{% endif %} </nobr>
                <br/>
                <nobr> {{ job.shifts|length }}/{{ job.slots }} Staffers <a href="staffers_by_job?id={{ job.id }}">Signed Up</a>
                {% if job.shifts %}
                    <a href="#" onClick="$(this).next().show().prev().remove() ; return false" style="display:block">View Staffers</a>
                    <div style="display:none">
                        {% for shift in job.shifts %}
                            <a href="../registration/form?id={{ shift.attendee.id }}">{{ shift.attendee.full_name }}</a> <br/>
                        {% endfor %}
                    </div>
                {% endif %}
            </td>
        {% endfor %}
    </tr>
{% endfor %}
</table>
-->
{% endblock %}
{% block page_scripts %}
<script type="text/javascript" src="../static/js/moment.js"></script> 


<script type="text/javascript" src="../static/js/fullcalendar.min.js"></script> 
<script type="text/javascript"> 


	$(document).ready(function() {

		var eventList =  new Array();
		    {% for job in jobs %}
                    eventList.push({
                                        title : "{{job.name}} ({{job.shifts | length }}/{{job.slots}})",
                                        start : "{{ job.start_time|datetime:"%Y-%m-%dT%H:%M:%S" }}",
                                        // duration {{job.duration}}
                                        end: "{{job.start_time|shift_end:job.duration}}",
                                        url : "form?id={{ job.id }}",
                                        {% if job.type == c.SETUP %}
                                        backgroundColor:"#0ff"
                                        {% else %}
                                        backgroundColor:"#0f0"
                                        {% endif %}
                                });
    {% endfor %}

		$('#shift_cal').fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'agendaWeek,agendaDay,listWeek'
			},
			defaultView: 'agendaDay',
			editable: true,
			allDaySlot: false,
			slotEventOverlap:false,
			eventLimit: true, // allow "more" link when too many events
			events: eventList
		});
                var curDate = $.urlParam('time');
                if(curDate != null) {
                        $("#shift_cal").fullCalendar( 'gotoDate',curDate);

                } else {
                        $("#shift_cal").fullCalendar('gotoDate', eventList[0].start);
                }

	
	});

$.urlParam = function(name){
   var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
   if (results==null){
      return null;
   }
   else{
      return results[1] || 0;
   }
}

</script>
{% endblock %}

