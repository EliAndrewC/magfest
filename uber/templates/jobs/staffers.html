{% extends "base-admin.html" %}
{% block title %}Staffer Summary{% endblock %}
{% block content %}

{% include "jobs/main_menu.html" %}

<div class="row">
    <div class="col-md-3">{{ attendees|length }} Staffers</div>
    <div class="col-md-3">{{ counts.regular_signups }} / {{ counts.regular_total }} Regular Hours Taken</div>
    <div class="col-md-3">{{ counts.restricted_signups }} / {{ counts.restricted_total }} Restricted Hours Taken</div>
    <div class="col-md-3">{{ counts.all_signups }} / {{ counts.all_total }} Total Hours Taken</div>
</div>

{% if checklist.relevant %}
    <br/>
    {% if checklist.completed %}
        You've already indicated that this list is valid, please email STOPS if this is incorrect.
    {% else %}
        <a href="#" onClick="$('#checkoff').show(); return false;">As a head of this department, this looks good to me.</a>
        <form id="checkoff" style="display:none" method="post" action="../dept_checklist/mark_item_complete">
        {% csrf_token %}
        <input type="hidden" name="slug" value="{{ checklist.conf.slug }}" />
        By clicking this button, you are telling us you've reviewed your volunteers and confirmed:
        <ul>
            <li>that no one is assigned to your department who shouldn't be, such as problem volunteers from previous years</li>
            <li>that no one is missing who you'd expect to be assigned here, such as staffers from previous years</li>
        </ul>
        <input type="submit" value="I Confirm This All Looks Good" />
        </form>
        <br/>
    {% endif %}
{% endif %}

<br/>
<span style="font-size:14pt ; font-weight:bold"> Staffers Assigned to This Area</span>
(<a href="mailto:eli@courtwright.org?bcc={{ emails }}">email these staffers</a>)<b>:</b>
<br/> <br/>

<table class="table table-striped datatable">
<thead><tr>
    <th> Attendee Name </th>
    {% if c.HAS_ACCOUNTS_ACCESS %}<th> Admin </th>{% endif %}
    <th> Badge</th>
    <th> [D] </th>
    <th> [T] </th>
    <th> [M] </th>
    <th> [L] </th>
    <th> Placeholder</th>
    <th> Hours Here </th>
    <th> Hours Total </th>
    <th> Checked In</th>
</tr>
</thead>
{% for attendee in attendees %}
    <tr>
        <td width="20%" data-order="{{ attendee.full_name }}" data-search="{{ attendee.full_name }}"> <a href="../registration/shifts?id={{ attendee.id }}">{{ attendee.full_name }}</a>        </td>
        {% if c.HAS_ACCOUNTS_ACCESS %}<td width="10">{% if attendee.admin_account %}Enabled{% else %}<input type="checkbox" name="id{{ forloop.counter }}" value="{{ attendee.id }}" onclick="adminList(this.value)"> Check To Enable{% endif %}</td>{% endif %}
        <td width="10">{% if not attendee.badge_num %}<font size="-1">TBD</font>{% else %}{{ attendee.badge_num }}{% endif %}</td>
        <td width="10">{% if attendee.is_dept_head %}<font size="-1">[D]</font>{% endif %}</td>
        <td width="10">{% if attendee.trusted_here %}<font size="-1">[T]</font>{% endif %}</td>
        <td width="10">{% if attendee.multiply_assigned %}<font size="-1">[M]</font>{% endif %}</td>
        <td width="10">{% if attendee.can_work_setup or attendee.can_work_teardown %}<font size="-1">[L]</font>{% endif %}</td>
        <td width="10">{{ attendee.placeholder }}</td>
        <td width="10">{{ attendee.hours_here }}</td>
        <td width="10">{{ attendee.weighted_hours }}</td>
        <td width="10">{{ attendee.checked_in|yesno:"Checked In,Not Checked In" }}</td>
    </tr>
{% endfor %}
</table>

<br/> <br/>

{% if c.HAS_ACCOUNTS_ACCESS %}
    <div>
    <button class="btn btn-default" onclick="checkAll()">Select All</button>
    <button class="btn btn-default" onclick="uncheckAll()">Deselect All</button>
    <h4>Accounts Selected: <i id="count">0</i></h4>
    <form id="admin_settings" method="post" action="add_bulk_admin_accounts" onsubmit="return add_admin_list()" role="form" class="form-inline">
        <input type="hidden" name="ids" id="ids" value="" />
        {% csrf_token %}
        <div class="form-group">
            {% checkgroup AdminAccount.access %}
        </div>
        <button type="submit" class="btn btn-default">Create Checked Accounts</button>
    </form>
    </div>

    <br/> <br/>
{% endif %}


<div style="margin-left:10px">
    [D]: <i>Staffers marked with a "D" are department heads.</i> <br/>
    [M]: <i>Staffers marked with a "M" are assigned to multiple locations</i> <br/>
    [T]: <i>Staffers marked with a "T" are trusted
         {% if location %}in this department{% else %}in at least one department{% endif %}
         </i> <br/>
    [L]: <i>Staffers marked with a "L" are working load-in and/or load-out</i>
</div>


{% if c.HAS_ACCOUNTS_ACCESS %}
<script src="../static/js/jquery.form.js"></script>
<script>
var list_of_ids = [];

$("#admin_settings").ajaxForm(function(message){
    toastr.info(message);
    setTimeout(function(){
        location.reload(true);
    }, 1500);
});

var checkAll = function(){
    $.each( $("input[name^='id']"), function () {
      $(this).prop("checked", true);
    });
};

var uncheckAll = function(){
    $.each( $("input[name^='id']"), function () {
      $(this).prop("checked", false);
    });
};

var adminList = function(id){
    var index = list_of_ids.indexOf(id);
    if(index == -1){
        list_of_ids.push(id);
    }
    else {
        list_of_ids.splice(index, 1);
    }
    $("#count").text(list_of_ids.length);
};

var add_admin_list = function(){
    var ids = $("#ids");
    ids.attr("value", list_of_ids.join());
    console.log(ids.attr("value"));
    return true;
}
</script>
{% endif %}

{% endblock %}
