{% extends 'signup_base.html' %}

{% block page_style %}
<style>
.fc-toolbar.fc-header-toolbar {
	margin-left:15px;
	margin-right:15px;
}
.shift_icon {
	border-radius:15px;
	width:30px;
	height:30px;
	display:inline-block;
}
.shift_taken {
	background-color:#239875;
}
.shift_available {
	background-color:#305fc9;
}
</style>
{% endblock %}
{% block main_content %}
<div class="hidden csrf_token">
{% csrf_token %}
</div>


<div class="row">
	<div class="col-md-12 text-center">
	<span style="font-size:16pt ; font-weight:bold" class="ng-binding">T U's available shifts</span>
   	</div>
</div>
<div class="row">
	<div class="col-md-12 text-center">
   		<span style="font-size:12pt ; font-style:italic" class="ng-binding">(If you are not T U, <a href="login">log in here</a>.)</span>
	</div>
</div>
<div class=row">
	<div class="col-md-12 text-center">
		<table width="100%" style="text-align:center">
   		<tbody><tr>
       			<td ng-bind-html-unsafe="'../static_views/stafferComps.html' | popupLink:'See What You Get For Volunteering'"></td>
       <!-- ngIf: !c.HIDE_SCHEDULE -->
   </tr>
   </tbody></table>
   <br>
   {% if 'schedule' in c.QUERY_STRING %}
        <a href="{{c.PATH}}{{c.PAGE_PATH}}">Click Here</a> to sign up for more shifts; you are currently signed up for {{hours}} weighted hours
   {% else %}
        <a href="{{c.PATH}}{{c.PAGE_PATH}}?{{c.QUERY_STRING}}&state=schedule">Click Here</a> to see the {{hours}} weighted hours worth of shifts you are signed up for

   {% endif %}
   <br> or <a href="index">Click Here</a> to return to the main page of the Volunteer Checklist.
	</div>
</div>
<div class="row">

        <div class="col-md-10 col-md-offset-1 col-xs-12">
                <span>
			<div class="shift_icon shift_taken"></div>= Available
		</span>
		<span>
		 <div class="shift_icon shift_available"></div> = Signed Up
		</span>
        </div>
</div>

<div class="row">

	<div class="col-md-10 col-md-offset-1 col-xs-12">
		<div id="shift_cal"></div>
	</div>
</div>
{% endblock %}
{% block page_script %}
    <script src="../static/deps/combined.js"></script>
    <script src="../angular/magfest.js"></script>

<script type="text/javascript" src="../static/js/moment.js"></script>

<script type="text/javascript" src="../static/js/fullcalendar.min.js"></script>

<script type="text/javascript">
        $(document).ready(function() {

		var eventList = new Array();
		    {% for job in jobs %}
                    {% if 'schedule' in c.QUERY_STRING and job.taken %}
			eventList.push({
                                        title : "{{job.name}}",
                                        start : "{{ job.start_time_local|datetime:"%Y-%m-%dT%H:%M:%S" }}",
                                        end : "{{job.start_time_local|shift_end:job.duration}}",
                                        id : "{{job.id}}",
                                        {% if job.taken %}
                                        backgroundColor: "#239875",
                                        taken: true
                                        {% else %}
                                        backgroundColor: "#305fc9",
                                        taken: false
                                        {% endif %}
                                });
		    {% elif 'schedule' not in c.QUERY_STRING %}
                        eventList.push({
                                        title : "{{job.name}}",
                                        start : "{{ job.start_time_local|datetime:"%Y-%m-%dT%H:%M:%S" }}",
                                        end : "{{job.start_time_local|shift_end:job.duration}}",
                                        id : "{{job.id}}",
                                        {% if job.taken %}
                                        backgroundColor: "#239875",
                                        taken: true
                                        {% else %}
                                        backgroundColor: "#305fc9",
                                        taken: false
                                        {% endif %}
                                });

		    {% endif %}
    		    {% endfor %}

                $('#shift_cal').fullCalendar({
                        header: {
                                left: 'prev,next today',
                                center: 'title',
                                right: 'agendaDay,listWeek'
                        },
			views: {
                agendaDay: { buttonText: 'list day' },
                listWeek: { buttonText: 'list week' }
            },

                        defaultView: 'listWeek',
                        editable: true,
                        allDaySlot: false,
                        eventLimit: true, // allow "more" link when too many events
                        events: eventList,
			eventClick: function(event) {
				var postData = {};
				//postData['job_id'] = event.id,
				postData['csrf_token'] =  $("div.csrf_token input").attr('value');
				var confirmStr = "Do you want to ";
				if (event.taken) {
					confirmStr += "drop ";
				} else {
					confirmStr += "signup ";
				}

				confirmStr += event.title + " at " + moment(event.start).toISOString() + "?";
				var r = confirm(confirmStr);
				if (r == true) {
    					txt = "You pressed OK!";
				
				
				var tgtShiftURL = "sign_up?job_id="+ event.id;
				if(event.taken) {
						tgtShiftURL = "drop?job_id=" + event.id;
				}
				$.post( tgtShiftURL,postData,function( data,status ) {
					window.location.href = window.location.pathname + "?tgtDate=" + moment(event.start).toISOString();

				});
				}
			}
                });
   		{% if 'schedule' in c.QUERY_STRING %}
			
                        $("#shift_cal").fullCalendar( 'changeView','listWeek');

		{% else %}

                // if opened with tgtDate, go to date in calendar

		{% endif %}
                var curDate = $.urlParam('tgtDate');
                if(curDate != null) {
                        $("#shift_cal").fullCalendar( 'changeView','agendaDay');
			$("#shift_cal").fullCalendar( 'gotoDate',curDate);

                } else {
			$("#shift_cal").fullCalendar('gotoDate', eventList[0].start);
		}
        });
$.urlParam = function(name){
   var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
   if (results==null){
      return null;
   }
   else{
      return results[1] || 0;
   }
}
</script>
{% endblock %}
