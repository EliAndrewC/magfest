{% macro ie7_compatibility_check() -%}
    <!--[if lte IE 7]>
        <script>
            if (!document.documentMode) { //if documentMode exists, this is a later IE in compatibility mode
                alert("This website requires IE 8 or later.");
            }
        </script>
    <![endif]-->
{%- endmacro %}


{% macro stripe_button(label) -%}
    <button class="btn btn-primary stripe-button-el">
        <span class="display: block; min-height: 30px;">{{label}}</span>
    </button>
{%- endmacro %}


{% macro popup_link(href, text='<sup>?</sup>') -%}
    <a onClick='window.open(&quot;{{ href }}&quot;, &quot;info&quot;, &quot;toolbar=no,height=500,width=375,scrollbars=yes&quot;).focus(); return false;' href='{{ href }}'>{{ text|safe }}</a>
{%- endmacro %}


{% macro checkbox(model, field_name, id=None, label=None, label_class=None, readonly=False, title=None) -%}
    {% if label %}
      <label
        class="checkbox-label{% if label_class %} {{ label_class }}{% endif %}"
        {% if title %}title="{{ title }}"{% endif %}>
    {% endif %}
    {% if readonly %}
      <input
        type="hidden"
        name="{{ field_name }}"
        id="{% if id %}{{ id }}{% else %}{{ field_name }}{% endif %}"
        value="{%- if model[field_name] -%}1{%- else -%}0{%- endif -%}" />
      <input
        type="checkbox"
        value="1"
        disabled
        {% if not label and title %}title="{{ title }}"{% endif %}
        {% if model[field_name] %}checked{% endif %} />
    {% else %}
      <input
        type="checkbox"
        name="{{ field_name }}"
        id="{% if id %}{{ id }}{% else %}{{ field_name }}{% endif %}"
        value="1"
        {% if not label and title %}title="{{ title }}"{% endif %}
        {% if model[field_name] %}checked{% endif %} />
    {% endif %}
    {% if label %}{{ label }}</label>{% endif %}
{%- endmacro %}


{% macro checkgroup(model, field_name, no_instance=False) -%}
    {%- set defaults = model[field_name] if not no_instance else None -%}
    {%- set defaults = defaults.split(",") if defaults else [] -%}
    {% for num, desc in model.get_field(field_name).type.choices -%}
        <label class="checkgroup checkbox-label" style="font-weight: normal;">
            <input type="checkbox" name="{{ field_name }}" value="{{ num }}" {% if num|string in defaults %}checked{% endif %} />
            {{ desc }}
        </label>
    {% endfor %}
{%- endmacro %}


{% macro nav_menu(model, current_page_path) -%}
    {% if not model.is_new -%}
        <table class="menu"><tr>
        {% for href, label, display in varargs|batch(3, False) if display %}
            {% set href = href.format(**model.__dict__) %}
            <td width="{{ 100 // loop.length }}%">
                {%- if current_page_path.endswith(href.split('?')[0]) -%}
                    {{ label }}
                {%- else -%}
                    <a href="{{ href }}">{{ label }}</a>
                {%- endif -%}
            </td>
        {% endfor %}
        </tr></table>
    {%- endif %}
{%- endmacro %}


{% macro checklist_image(enabled) -%}
    <img src="../static/images/checkbox_{% if not enabled %}un{% endif %}checked.png" style="vertical-align:top ; margin-right:5px" height="20" width="20" />
{%- endmacro %}


{% macro prereg_wizard(page_path, prereg_request_hotel_info_open) -%}
  {%- if prereg_request_hotel_info_open -%}
    {%-
      set steps = [
          (('form', 'post_form'), 'Enter Info'),
          ('hotel', 'Hotel Booking'),
          (('index', 'preregistration', ''), 'Review & Pay'),
          ('paid_preregistrations', 'Done')]
    -%}
  {% else %}
    {%-
      set steps = [
          (('form', 'post_form'), 'Enter Info'),
          (('index', 'preregistration', ''), 'Review & Pay'),
          ('paid_preregistrations', 'Done')]
    -%}
  {%- endif -%}
  {%- set step_count = steps|length -%}
  {%- set col_size = (12 / step_count)|round(0, 'floor')|int -%}
  {%- set vars = {'is_complete': False} -%}
  <div class="row bs-wizard">
    {% for url, text in steps -%}
      <div class="col-xs-{{ col_size }} bs-wizard-step {% if page_path|basename in url -%}active{%- if vars.update({'is_complete': True}) -%}{%- endif -%}{%- elif vars.is_complete -%}disabled{%- else -%}complete{%- endif %}">
        <div class="text-center bs-wizard-stepnum">Step {{ loop.index }}</div>
        <div class="progress"><div class="progress-bar"></div></div>
        <a class="bs-wizard-dot"></a>
        <div class="bs-wizard-info text-center">{{ text }}</div>
      </div>
    {%- endfor %}
  </div>
{%- endmacro %}

{% macro address_form(group=False, attendee=False, is_dealer=False, collect_full_address=False, copy_address=False, name_prefix="") -%}
    {% set group_or_attendee=group if group else attendee %}
    {% set id_prefix=group.id|replace("-","") if group else attendee.id|replace("-","") %}
    {% if is_dealer or collect_full_address %}
        <script src="../static/deps/selectToAutocomplete/jquery.select-to-autocomplete.js"></script>
        <script type="text/javascript">{% include "region_opts.html" %}</script>

        <script type="text/javascript">
            var regionChange{{ id_prefix }} = function() {
                {{ 'setInternational();' if not group else '' }}

                var regionopts = $("#{{ id_prefix }}region");
                var whichCountry = $("#{{ id_prefix }}country").find(':selected').text();
                switch(whichCountry) {
                    case 'United States':
                        regionopts.replaceWith('<select name="{{ name_prefix }}region" id="{{ id_prefix }}region" class="form-control"></select>');
                        $("[name='{{ name_prefix }}region']").html(regionsforUS);
                        break;
                    case 'Canada':
                        regionopts.replaceWith('<select name="{{ name_prefix }}region" id="{{ id_prefix }}region" class="form-control"></select>');
                        $("[name='{{ name_prefix }}region']").html(regionsforCanada);
                        break;
                }
                var optionToSelect{{ id_prefix }} = $("#{{ id_prefix }}region option[value='{{ group_or_attendee.region }}']");
                if (optionToSelect{{ id_prefix }}.length) {
                    optionToSelect{{ id_prefix }}.prop('selected', true)
                }
            };

            $(function() {
                {{ 'setInternational();' if not group else '' }}
                $("#{{ id_prefix }}country").val('{{ group_or_attendee.country }}');
                $("#{{ id_prefix }}country").selectToAutocomplete();
                $("#{{ id_prefix }}country").change(function() {
                    $("#{{ id_prefix }}region").replaceWith('<input type="text" name="{{ name_prefix }}region" id="{{ id_prefix }}region" value="{{ group_or_attendee.region }}" class="form-control" placeholder="State/Province">');
                    regionChange{{ id_prefix }}();
                });

                $("#{{ id_prefix }}region").val('{{ group_or_attendee.region }}');
                regionChange{{ id_prefix }}();
            });
        </script>
    {% endif %}

    {% if is_dealer and collect_full_address and not group %}
        <script type="text/javascript">
        var copyAddress{{ id_prefix }} = function () {
            if ($("#{{ id_prefix }}copy_address").prop('checked')) {
                $('.{{ id_prefix }}address_details').hide();
            } else if ($("#{{ id_prefix }}copy_address").length) {
                $('.{{ id_prefix }}address_details').show();
            }
        };
        $(function () {
            if ($('#{{ id_prefix }}copy_address').length) {
                copyAddress{{ id_prefix }}();
                $('#{{ id_prefix }}copy_address').change(copyAddress{{ id_prefix }});
            }
        })
        </script>
        <div class="form-group">
            <div class="col-sm-6 col-sm-offset-3">
                <label for="{{ id_prefix }}copy_address" class="checkbox-label">
                    <input type="checkbox" name="copy_address" id="{{ id_prefix }}copy_address" value="1" {% if copy_address %}checked="checked"{% endif %} />
                    Use my business address for my personal address.
                </label>
            </div>
        </div>
    {% endif %}

    <div class="form-group {{ id_prefix }}address_details">
        <label for="{{ id_prefix }}country" class="col-sm-3 control-label">Country</label>
        <div class="col-sm-6">
            <select name="{{ name_prefix }}country" id="{{ id_prefix }}country" class="form-control" placeholder="Country" autofocus="autofocus" autocorrect="off" autocomplete="country">
                {% include "country_opts.html" %}
            </select>
        </div>
    </div>
    <div class="form-group {{ id_prefix }}address_details">
        <label for="{{ id_prefix }}address1" class="col-sm-3 control-label">Street</label>
        <div class="col-sm-6">
            <input type="text" name="{{ name_prefix }}address1" class="form-control" placeholder="Address Line 1" value="{{ group_or_attendee.address1 }}" />
        </div>
    </div>
    <div class="form-group {{ id_prefix }}address_details">
        <div class="col-sm-6 col-sm-offset-3">
            <input type="text" name="{{ name_prefix }}address2" class="form-control" placeholder="Address Line 2" value="{{ group_or_attendee.address2 }}" />
        </div>
    </div>
    <div class="form-group {{ id_prefix }}address_details">
        <label for="{{ id_prefix }}city" class="col-sm-3 control-label">City</label>
        <div class="col-sm-6">
            <input type="text" name="{{ name_prefix }}city" class="form-control" placeholder="City" value="{{ group_or_attendee.city }}" />
        </div>
    </div>
    <div class="form-group {{ id_prefix }}address_details">
        <label for="{{ id_prefix }}region" class="col-sm-3 control-label">State/Region</label>
        <div class="col-sm-6">
            <input type="text" name="{{ name_prefix }}region" id="{{ id_prefix }}region" class="form-control" placeholder="State/Province" value="{{ group_or_attendee.region }}" autocomplete="address-level1" />
        </div>
    </div>
    <div class="form-group {{ id_prefix }}address_details">
        <label for="{{ id_prefix }}zip_code" class="col-sm-3 control-label">ZIP/Postal Code</label>
        <div class="col-sm-6">
            <input type="text" name="{{ name_prefix }}zip_code" class="form-control" value="{{ group_or_attendee.zip_code }}"/>
        </div>
    </div>
{%- endmacro %}
